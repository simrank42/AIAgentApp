import{B as l,La as g,d as c,q as E,u as R}from"./chunk-QCJJ4XD2.js";var _={production:!0,apiUrl:"/api/v1",wsUrl:window.location.protocol==="https:"?"wss://"+window.location.host:"ws://"+window.location.host,enableDebugTools:!1,strictMode:!0,logLevel:"error",captchaEnabled:!0,maxRetryAttempts:3,requestTimeout:3e4,tokenRefreshInterval:840*1e3};var T="access_token",u="user_email";var d={NETWORK_ERROR:"Network error. Please check your connection and try again.",UNAUTHORIZED:"Session expired. Please log in again.",FORBIDDEN:"You do not have permission to perform this action.",NOT_FOUND:"The requested resource was not found.",VALIDATION_ERROR:"Please check your input and try again.",SERVER_ERROR:"Server error. Please try again later.",TIMEOUT_ERROR:"Request timed out. Please try again.",UNKNOWN_ERROR:"An unexpected error occurred. Please try again.",CAPTCHA_REQUIRED:"CAPTCHA verification is required for login.",CAPTCHA_INVALID:"Invalid CAPTCHA. Please try again.",TOO_MANY_ATTEMPTS:"Too many failed attempts. Please try again later.",INVALID_CREDENTIALS:"Invalid email or password.",EMAIL_ALREADY_EXISTS:"Email is already registered.",PASSWORD_TOO_WEAK:"Password must be at least 6 characters long.",INVALID_EMAIL:"Please enter a valid email address.",REQUIRED_FIELD:"This field is required.",MIN_LENGTH:"Must be at least {min} characters long.",MAX_LENGTH:"Must be no more than {max} characters long.",PASSWORDS_DO_NOT_MATCH:"Passwords do not match."};var n=class n{constructor(){this.STORAGE_PREFIX="chat_secure_";this.ENCRYPTION_KEY="chat_app_key_2024"}setSecureItem(e,t){try{let s=this.encrypt(t);sessionStorage.setItem(this.STORAGE_PREFIX+e,s)}catch(s){console.error("Failed to store secure item:",s),sessionStorage.setItem(e,t)}}getSecureItem(e){try{let t=sessionStorage.getItem(this.STORAGE_PREFIX+e);return t?this.decrypt(t):null}catch(t){return console.error("Failed to retrieve secure item:",t),sessionStorage.getItem(e)}}removeSecureItem(e){sessionStorage.removeItem(this.STORAGE_PREFIX+e),sessionStorage.removeItem(e)}clearSecureStorage(){Object.keys(sessionStorage).forEach(t=>{t.startsWith(this.STORAGE_PREFIX)&&sessionStorage.removeItem(t)})}encrypt(e){try{let t="";for(let s=0;s<e.length;s++){let r=this.ENCRYPTION_KEY.charCodeAt(s%this.ENCRYPTION_KEY.length),o=e.charCodeAt(s);t+=String.fromCharCode(o^r)}return btoa(t)}catch(t){return console.error("Encryption failed:",t),e}}decrypt(e){try{let t=atob(e),s="";for(let r=0;r<t.length;r++){let o=this.ENCRYPTION_KEY.charCodeAt(r%this.ENCRYPTION_KEY.length),I=t.charCodeAt(r);s+=String.fromCharCode(I^o)}return s}catch(t){return console.error("Decryption failed:",t),e}}isSecureStorageAvailable(){try{let e="test_secure_storage",t="test_value";this.setSecureItem(e,t);let s=this.getSecureItem(e);return this.removeSecureItem(e),s===t}catch{return!1}}};n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=E({token:n,factory:n.\u0275fac,providedIn:"root"});var h=n;var i=class i{constructor(){this.http=R(g);this.baseUrl=_.apiUrl;this.tokenRefreshTimer=null;this.secureStorage=R(h);this.currentUser=l(this.secureStorage.getSecureItem(u));this.accessToken=l(this.secureStorage.getSecureItem(T));this.isLoggingOut=!1;this.accessToken()&&this.startTokenRefresh()}signup(e,t){return c(this,null,function*(){yield this.http.post(`${this.baseUrl}/auth/signup`,{email:e,password:t}).toPromise()})}login(e,t,s){return c(this,null,function*(){let r={email:e,password:t};s&&(r.captcha_id=s.captcha_id,r.captcha_answer=s.captcha_answer);let o=yield this.http.post(`${this.baseUrl}/auth/login`,r).toPromise();o?.access_token&&(this.secureStorage.setSecureItem(T,o.access_token),this.secureStorage.setSecureItem(u,e),this.accessToken.set(o.access_token),this.currentUser.set(e),this.startTokenRefresh())})}refresh(){return c(this,null,function*(){let e=yield this.http.post(`${this.baseUrl}/auth/refresh`,{}).toPromise();e?.access_token&&(this.secureStorage.setSecureItem(T,e.access_token),this.accessToken.set(e.access_token))})}startTokenRefresh(){this.tokenRefreshTimer&&clearTimeout(this.tokenRefreshTimer),this.tokenRefreshTimer=setTimeout(()=>c(this,null,function*(){try{yield this.refresh(),this.startTokenRefresh()}catch(e){console.error("Token refresh failed:",e)}}),_.tokenRefreshInterval)}logout(){return c(this,null,function*(){if(!this.isLoggingOut){this.isLoggingOut=!0;try{this.tokenRefreshTimer&&(clearTimeout(this.tokenRefreshTimer),this.tokenRefreshTimer=null);try{yield this.http.post(`${this.baseUrl}/auth/logout`,{}).toPromise()}catch(e){console.warn("Logout API call failed:",e)}this.secureStorage.removeSecureItem(T),this.secureStorage.removeSecureItem(u),this.currentUser.set(null),this.accessToken.set(null)}finally{this.isLoggingOut=!1}}})}isLogoutInProgress(){return this.isLoggingOut}ngOnDestroy(){this.tokenRefreshTimer&&(clearTimeout(this.tokenRefreshTimer),this.tokenRefreshTimer=null)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=E({token:i,factory:i.\u0275fac,providedIn:"root"});var S=i;var a=class a{constructor(){this.toasts=l([]);this.id=1}show(e,t="info"){let s={id:this.id++,text:e,type:t};this.toasts.update(r=>[...r,s]),setTimeout(()=>this.dismiss(s.id),3e3)}dismiss(e){this.toasts.update(t=>t.filter(s=>s.id!==e))}};a.\u0275fac=function(t){return new(t||a)},a.\u0275prov=E({token:a,factory:a.\u0275fac,providedIn:"root"});var m=a;export{_ as a,T as b,d as c,h as d,S as e,m as f};
